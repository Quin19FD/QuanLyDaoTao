<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Phân Công Giảng Dạy</title>
    <style>
        * {
            font-size: 20px;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 90%;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 30px;
            color: #ff8c66;
            text-align: center;
            margin-bottom: 10px;
        }

        p {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            font-size: 18px;
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #ff8c66;
            color: white;
        }

        td {
            background-color: #fff7f2;
        }

        button {
            font-size: 20px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.3s ease;
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .add-btn {
            background-color: #ff8c66;
            color: white;
            margin-bottom: 20px;
        }

        .view-btn {
            background-color: #4CAF50;
            color: white;
        }

        .edit-btn {
            background-color: #FFC107;
            color: white;
        }

        .delete-btn {
            background-color: #F44336;
            color: white;
        }

        .save-btn {
            background-color: #4CAF50;
            color: white;
            margin-top: 20px;
        }

        .cancel-btn {
            background-color: #ccc;
            color: white;
            margin-top: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 70%;
            max-width: 800px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .form-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .form-table th,
        .form-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .form-table th {
            background-color: #ff8c66;
            color: #fff;
            text-transform: uppercase;
            font-weight: 600;
            width: 30%;
        }

        .form-table td {
            background-color: #fff7f2;
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        input:focus,
        select:focus {
            border-color: #ff8c66;
            outline: none;
            box-shadow: 0 0 5px rgba(255, 140, 102, 0.3);
        }

        .search-box {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
        }

        .search-box input {
            flex: 1;
            padding: 10px;
        }

        .search-box button {
            padding: 10px 15px;
            background-color: #ff8c66;
            color: white;
        }

        .filter-box {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
        }

        .filter-box select {
            flex: 1;
            padding: 10px;
        }

        .action-buttons {
            text-align: right;
            margin-top: 20px;
        }

        .view-details p {
            margin: 10px 0;
            padding: 10px;
            background-color: #fff7f2;
            border-left: 4px solid #ff8c66;
            border-radius: 5px;
        }

        /* Thêm style cho nút trở về trang chủ */
        .back-home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background-color: #ff8c66;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            text-decoration: none;
        }

        .back-home-btn:hover {
            background-color: #e67e5a;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .back-home-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 3px rgba(0,0,0,0.2);
        }

        .back-home-btn i {
            font-size: 18px;
        }
    </style>
    <!-- Thêm Font Awesome để sử dụng icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>
    <!-- Thêm nút trở về trang chủ -->
    <a th:href="@{/home}" class="back-home-btn">
        <i class="fas fa-home"></i>
        Trang Chủ
    </a>
    <div class="container">
        <h1>QUẢN LÝ PHÂN CÔNG GIẢNG DẠY</h1>

        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Tìm kiếm theo mã hoặc tên giảng viên...">
            <button onclick="searchAssignments()">Tìm kiếm</button>
        </div>

        <div class="filter-box">
            <select id="semesterFilter" onchange="filterAssignments()">
                <option value="">-- Lọc theo học kỳ --</option>
                <option value="1">Học kỳ 1</option>
                <option value="2">Học kỳ 2</option>
            </select>
            <select id="departmentFilter" onchange="filterAssignments()">
                <option value="">-- Lọc theo bộ môn --</option>
                <option value="CNPM">Công nghệ phần mềm</option>
                <option value="HTTT">Hệ thống thông tin</option>
                <option value="MMT">Mạng máy tính</option>
            </select>
        </div>

        <button th:if="${isAdmin}" class="add-btn" onclick="openAddModal()">+ Thêm Phân Công Mới</button>

        <table id="assignmentTable">
            <thead>
                <tr>
                    <th>TT</th>
                    <th>Mã CB</th>
                    <th>Họ và tên GV</th>
                    <th>Năm sinh</th>
                    <th>Chức danh, học vị</th>
                    <th>Tên học phần</th>
                    <th>Mã học phần</th>
                    <th>Số TC</th>
                    <th>Số tiết HP</th>
                    <th>Số lượng nhóm</th>
                    <th>Học kì</th>
                    <th>Tổng tiết GD</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody id="assignmentTableBody">
                <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- Modal for Adding New Assignment -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addModal')">×</span>
            <h2>Thêm Phân Công Mới</h2>
            <form id="addForm">
                <table class="form-table">
                    <thead>
                        <tr>
                            <th>Tiêu chí</th>
                            <th>Thông tin</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Mã CB</td>
                            <td><input type="text" id="teacherId" placeholder="VD: GV01" required></td>
                        </tr>
                        <tr>
                            <td>Họ tên GV</td>
                            <td><input type="text" id="teacherName" placeholder="VD: Nguyễn Văn A" required></td>
                        </tr>
                        <tr>
                            <td>Năm sinh</td>
                            <td><input type="number" id="birthYear" min="1900" max="2025" placeholder="VD: 1980"
                                    required></td>
                        </tr>
                        <tr>
                            <td>Chức danh, học vị</td>
                            <td><input type="text" id="degree" placeholder="VD: TS, Giảng viên chính" required></td>
                        </tr>
                        <tr>
                            <td>Tên học phần</td>
                            <td><input type="text" id="courseName" placeholder="VD: CTDL & GT" required></td>
                        </tr>
                        <tr>
                            <td>Mã học phần</td>
                            <td><input type="text" id="courseId" placeholder="VD: CS101" required></td>
                        </tr>
                        <tr>
                            <td>Số TC</td>
                            <td><input type="number" id="credits" min="1" max="10" placeholder="VD: 3" required></td>
                        </tr>
                        <tr>
                            <td>Số tiết HP</td>
                            <td><input type="number" id="hours" min="1" placeholder="VD: 45" required></td>
                        </tr>
                        <tr>
                            <td>Số lượng nhóm</td>
                            <td><input type="number" id="groups" min="1" placeholder="VD: 2" required></td>
                        </tr>
                        <tr>
                            <td>Học kì</td>
                            <td>
                                <select id="semester" required>
                                    <option value="" disabled selected>Chọn học kỳ</option>
                                    <option value="1">Học kỳ 1</option>
                                    <option value="2">Học kỳ 2</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>Bộ môn</td>
                            <td>
                                <select id="department" required>
                                    <option value="" disabled selected>Chọn bộ môn</option>
                                    <option value="CNPM">Công nghệ phần mềm</option>
                                    <option value="HTTT">Hệ thống thông tin</option>
                                    <option value="MMT">Mạng máy tính</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="action-buttons">
                    <button type="submit" class="save-btn" onclick="saveNewAssignment()">Thêm</button>
                    <button type="button" class="cancel-btn" onclick="closeModal('addModal')">Hủy</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Editing Assignment -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editModal')">×</span>
            <h2>Sửa Phân Công</h2>
            <form id="editForm">
                <table class="form-table">
                    <thead>
                        <tr>
                            <th>Tiêu chí</th>
                            <th>Thông tin</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Mã CB</td>
                            <td><input type="text" id="editTeacherId" readonly></td>
                        </tr>
                        <tr>
                            <td>Họ tên GV</td>
                            <td><input type="text" id="editTeacherName" readonly></td>
                        </tr>
                        <tr>
                            <td>Tên học phần</td>
                            <td><input type="text" id="editCourseName" placeholder="VD: CTDL & GT" required></td>
                        </tr>
                        <tr>
                            <td>Mã học phần</td>
                            <td><input type="text" id="editCourseId" placeholder="VD: CS101" required></td>
                        </tr>
                        <tr>
                            <td>Số TC</td>
                            <td><input type="number" id="editCredits" min="1" max="10" placeholder="VD: 3" required>
                            </td>
                        </tr>
                        <tr>
                            <td>Số tiết HP</td>
                            <td><input type="number" id="editHours" min="1" placeholder="VD: 45" required></td>
                        </tr>
                        <tr>
                            <td>Số lượng nhóm</td>
                            <td><input type="number" id="editGroups" min="1" placeholder="VD: 2" required></td>
                        </tr>
                        <tr>
                            <td>Học kì</td>
                            <td>
                                <select id="editSemester" required>
                                    <option value="" disabled>Chọn học kỳ</option>
                                    <option value="1">Học kỳ 1</option>
                                    <option value="2">Học kỳ 2</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="action-buttons">
                    <button type="submit" class="save-btn" onclick="saveEdit()">Lưu thay đổi</button>
                    <button type="button" class="cancel-btn" onclick="closeModal('editModal')">Hủy</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Delete Confirmation -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('deleteModal')">×</span>
            <h2>Xác Nhận Xóa</h2>
            <p>Bạn có chắc chắn muốn xóa phân công này không?</p>
            <input type="hidden" id="deleteIndex">
            <div class="action-buttons">
                <button class="delete-btn" onclick="confirmDelete()">Xóa</button>
                <button class="cancel-btn" onclick="closeModal('deleteModal')">Hủy</button>
            </div>
        </div>
    </div>

    <!-- Modal for Viewing Details -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('viewModal')">×</span>
            <h2>Chi Tiết Phân Công</h2>
            <div class="view-details" id="viewDetails"></div>
            <div class="action-buttons">
                <button class="cancel-btn" onclick="closeModal('viewModal')">Đóng</button>
            </div>
        </div>
    </div>

    <script>
        const isAdmin = /*[[${isAdmin}]]*/ false;
        
        // Dữ liệu mẫu
        let assignments = [
            {
                id: 1,
                teacherId: "GV01",
                teacherName: "Nguyễn Văn A",
                birthYear: 1980,
                degree: "TS, Giảng viên chính",
                courseName: "CTDL & GT",
                courseId: "CS101",
                credits: 3,
                hours: 45,
                groups: 2,
                semester: "1",
                totalHours: 90,
                department: "CNPM"
            },
            {
                id: 2,
                teacherId: "GV02",
                teacherName: "Trần Thị B",
                birthYear: 1985,
                degree: "ThS, Giảng viên",
                courseName: "OOP",
                courseId: "CS102",
                credits: 3,
                hours: 45,
                groups: 2,
                semester: "2",
                totalHours: 90,
                department: "CNPM"
            },
            {
                id: 3,
                teacherId: "GV03",
                teacherName: "Lê Văn C",
                birthYear: 1978,
                degree: "TS, Phó trưởng khoa",
                courseName: "Web Design",
                courseId: "CS103",
                credits: 3,
                hours: 45,
                groups: 2,
                semester: "1",
                totalHours: 90,
                department: "HTTT"
            },
            {
                id: 4,
                teacherId: "GV04",
                teacherName: "Phạm Thị D",
                birthYear: 1990,
                degree: "CN, Trợ giảng",
                courseName: "Mạng máy tính",
                courseId: "CS104",
                credits: 2,
                hours: 30,
                groups: 1,
                semester: "2",
                totalHours: 45,
                department: "MMT"
            }
        ];

        // Hiển thị danh sách phân công
        function renderAssignments(data = assignments) {
            const tableBody = document.getElementById("assignmentTableBody");
            tableBody.innerHTML = "";

            data.forEach((assignment, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                <td>${index + 1}</td>
                <td>${assignment.teacherId}</td>
                <td>${assignment.teacherName}</td>
                <td>${assignment.birthYear}</td>
                <td>${assignment.degree}</td>
                <td>${assignment.courseName}</td>
                <td>${assignment.courseId}</td>
                <td>${assignment.credits}</td>
                <td>${assignment.hours}</td>
                <td>${assignment.groups}</td>
                <td>${assignment.semester}</td>
                <td>${assignment.totalHours}</td>
                <td>
                    <button class="view-btn" onclick="viewAssignment(${index})">Xem</button>
                    ${isAdmin ? `
                    <button class="edit-btn" onclick="editAssignment(${index})">Sửa</button>
                    <button class="delete-btn" onclick="openDeleteModal(${index})">Xóa</button>
                    ` : ''}
                </td>
            `;
                tableBody.appendChild(row);
            });
        }

        // Mở modal thêm mới
        function openAddModal() {
            if (!isAdmin) return;
            document.getElementById("addModal").style.display = "flex";
            document.getElementById("addForm").reset();
        }

        // Mở modal sửa
        function editAssignment(index) {
            if (!isAdmin) return;
            const assignment = assignments[index];
            document.getElementById("editIndex").value = index;
            document.getElementById("editTeacherId").value = assignment.teacherId;
            document.getElementById("editTeacherName").value = assignment.teacherName;
            document.getElementById("editCourseName").value = assignment.courseName;
            document.getElementById("editCourseId").value = assignment.courseId;
            document.getElementById("editCredits").value = assignment.credits;
            document.getElementById("editHours").value = assignment.hours;
            document.getElementById("editGroups").value = assignment.groups;
            document.getElementById("editSemester").value = assignment.semester;

            document.getElementById("editModal").style.display = "flex";
        }

        // Mở modal xóa
        function openDeleteModal(index) {
            if (!isAdmin) return;
            document.getElementById("deleteIndex").value = index;
            document.getElementById("deleteModal").style.display = "flex";
        }

        // Xem chi tiết
        function viewAssignment(index) {
            const assignment = assignments[index];
            const viewDetails = document.getElementById("viewDetails");

            viewDetails.innerHTML = `
            <p><strong>Mã CB:</strong> ${assignment.teacherId}</p>
            <p><strong>Họ tên GV:</strong> ${assignment.teacherName}</p>
            <p><strong>Năm sinh:</strong> ${assignment.birthYear}</p>
            <p><strong>Chức danh, học vị:</strong> ${assignment.degree}</p>
            <p><strong>Tên học phần:</strong> ${assignment.courseName}</p>
            <p><strong>Mã học phần:</strong> ${assignment.courseId}</p>
            <p><strong>Số TC:</strong> ${assignment.credits}</p>
            <p><strong>Số tiết HP:</strong> ${assignment.hours}</p>
            <p><strong>Số lượng nhóm:</strong> ${assignment.groups}</p>
            <p><strong>Học kì:</strong> ${assignment.semester}</p>
            <p><strong>Tổng tiết GD:</strong> ${assignment.totalHours}</p>
            <p><strong>Bộ môn:</strong> ${assignment.department}</p>
        `;

            document.getElementById("viewModal").style.display = "flex";
        }

        // Đóng modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }

        // Xác nhận xóa
        function confirmDelete() {
            const index = document.getElementById("deleteIndex").value;
            assignments.splice(index, 1);
            closeModal("deleteModal");
            renderAssignments();
        }

        // Lưu phân công mới
        function saveNewAssignment() {
            const teacherId = document.getElementById("teacherId").value.trim();
            const teacherName = document.getElementById("teacherName").value.trim();
            const birthYear = parseInt(document.getElementById("birthYear").value);
            const degree = document.getElementById("degree").value.trim();
            const courseName = document.getElementById("courseName").value.trim();
            const courseId = document.getElementById("courseId").value.trim();
            const credits = parseInt(document.getElementById("credits").value);
            const hours = parseInt(document.getElementById("hours").value);
            const groups = parseInt(document.getElementById("groups").value);
            const semester = document.getElementById("semester").value;
            const department = document.getElementById("department").value;

            // Validation
            if (!teacherId || !teacherName || !degree || !courseName || !courseId || !semester || !department) {
                alert("Vui lòng điền đầy đủ các trường bắt buộc!");
                return;
            }
            if (isNaN(birthYear) || birthYear < 1900 || birthYear > 2025) {
                alert("Năm sinh phải từ 1900 đến 2025!");
                return;
            }
            if (isNaN(credits) || credits < 1 || credits > 10) {
                alert("Số tín chỉ phải từ 1 đến 10!");
                return;
            }
            if (isNaN(hours) || hours < 1) {
                alert("Số tiết học phần phải lớn hơn 0!");
                return;
            }
            if (isNaN(groups) || groups < 1) {
                alert("Số lượng nhóm phải lớn hơn 0!");
                return;
            }

            // Tính tổng số tiết giảng dạy
            const totalHours = hours * groups;

            const newAssignment = {
                id: assignments.length + 1,
                teacherId,
                teacherName,
                birthYear,
                degree,
                courseName,
                courseId,
                credits,
                hours,
                groups,
                semester,
                totalHours,
                department
            };

            assignments.push(newAssignment);
            closeModal("addModal");
            renderAssignments();
        }

        // Lưu chỉnh sửa
        function saveEdit() {
            const index = document.getElementById("editIndex").value;
            const assignment = assignments[index];

            const courseName = document.getElementById("editCourseName").value.trim();
            const courseId = document.getElementById("editCourseId").value.trim();
            const credits = parseInt(document.getElementById("editCredits").value);
            const hours = parseInt(document.getElementById("editHours").value);
            const groups = parseInt(document.getElementById("editGroups").value);
            const semester = document.getElementById("editSemester").value;

            // Validation
            if (!courseName || !courseId || !semester) {
                alert("Vui lòng điền đầy đủ các trường bắt buộc!");
                return;
            }
            if (isNaN(credits) || credits < 1 || credits > 10) {
                alert("Số tín chỉ phải từ 1 đến 10!");
                return;
            }
            if (isNaN(hours) || hours < 1) {
                alert("Số tiết học phần phải lớn hơn 0!");
                return;
            }
            if (isNaN(groups) || groups < 1) {
                alert("Số lượng nhóm phải lớn hơn 0!");
                return;
            }

            assignment.courseName = courseName;
            assignment.courseId = courseId;
            assignment.credits = credits;
            assignment.hours = hours;
            assignment.groups = groups;
            assignment.semester = semester;
            assignment.totalHours = hours * groups;

            closeModal("editModal");
            renderAssignments();
        }

        // Tìm kiếm phân công
        function searchAssignments() {
            const searchTerm = document.getElementById("searchInput").value.toLowerCase();

            if (!searchTerm) {
                renderAssignments();
                return;
            }

            const filteredAssignments = assignments.filter(assignment =>
                assignment.teacherId.toLowerCase().includes(searchTerm) ||
                assignment.teacherName.toLowerCase().includes(searchTerm) ||
                assignment.courseName.toLowerCase().includes(searchTerm) ||
                assignment.courseId.toLowerCase().includes(searchTerm)
            );

            renderAssignments(filteredAssignments);
        }

        // Lọc phân công
        function filterAssignments() {
            const semesterFilter = document.getElementById("semesterFilter").value;
            const departmentFilter = document.getElementById("departmentFilter").value;

            let filteredAssignments = assignments;

            if (semesterFilter) {
                filteredAssignments = filteredAssignments.filter(a => a.semester === semesterFilter);
            }

            if (departmentFilter) {
                filteredAssignments = filteredAssignments.filter(a => a.department === departmentFilter);
            }

            renderAssignments(filteredAssignments);
        }

        // Khởi tạo trang
        window.onload = function () {
            renderAssignments();

            // Thêm sự kiện Enter cho ô tìm kiếm
            document.getElementById("searchInput").addEventListener("keyup", function (event) {
                if (event.key === "Enter") {
                    searchAssignments();
                }
            });
        };
    </script>
</body>

</html>