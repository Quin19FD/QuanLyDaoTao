<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Danh Mục Học Phần - Khoa CNTT</title>
    <style>
        * {
            font-size: 20px;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 90%;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 30px;
            color: #ff8c66;
            text-align: center;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .controls input,
        .controls select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #ff8c66;
            color: white;
        }

        td {
            background-color: #fff7f2;
        }

        tr:hover {
            background-color: #ffe6d5;
            cursor: pointer;
        }

        button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
        }

        .add-btn {
            background-color: #ff8c66;
            color: white;
        }

        .delete-btn {
            background-color: #F44336;
            color: white;
        }

        .edit-btn {
            background-color: #FFC107;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 100%;
            max-width: 1000px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background-color: #ff8c66;
            color: white;
            padding: 15px 20px;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #ffe6d5;
        }

        .modal-body {
            padding: 20px;
            background-color: #fff7f2;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #ffe6d5;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-row label {
            font-weight: bold;
            color: #ff8c66;
            flex: 1;
        }

        .info-row span,
        .info-row select {
            flex: 2;
            color: #333;
        }

        .form-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #ffe6d5;
        }

        .form-row:last-child {
            border-bottom: none;
        }

        .form-row label {
            font-weight: bold;
            color: #ff8c66;
            flex: 1;
        }

        .form-row input,
        .form-row select,
        .form-row .static-field {
            flex: 2;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 20px;
            transition: border-color 0.3s ease;
        }

        .form-row .static-field {
            background-color: #f0f0f0;
            border: none;
            padding: 8px;
            color: #666;
        }

        .form-row input:focus,
        .form-row select:focus {
            border-color: #ff8c66;
            outline: none;
        }

        .dept-select {
            height: 80px;
            background-color: #fff;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 20px;
        }

        .save-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .save-btn:hover {
            background-color: #45a049;
        }

        .cancel-btn {
            background-color: #ccc;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .cancel-btn:hover {
            background-color: #b3b3b3;
        }

        /* Thêm style cho nút trở về trang chủ */
        .back-home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background-color: #ff8c66;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .back-home-btn:hover {
            background-color: #e67e5a;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .back-home-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 3px rgba(0,0,0,0.2);
        }

        .back-home-btn i {
            font-size: 18px;
        }
    </style>
    <!-- Thêm Font Awesome để sử dụng icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>
    <!-- Thêm nút trở về trang chủ -->
    <a th:href="@{/home}" class="back-home-btn">
        <i class="fas fa-home"></i>
        Trang Chủ
    </a>
    <div class="container">
        <h1>QUẢN LÝ DANH MỤC HỌC PHẦN - KHOA CNTT</h1>
        <div class="controls">
            <button class="add-btn" th:if="${isAdmin}" onclick="openAddModal()">+ Thêm Học Phần</button>
            <input type="text" id="searchInput" placeholder="Tìm kiếm theo mã hoặc tên..." onkeyup="searchCourses()">
            <select id="filterBlock" onchange="filterCourses()">
                <option value="">Lọc theo Khối Kiến Thức</option>
                <option value="Khối kiến thức giáo dục đại cương">Khối kiến thức giáo dục đại cương</option>
                <option value="Khối kiến thức giáo dục chuyên nghiệp">Khối kiến thức giáo dục chuyên nghiệp</option>
            </select>
            <select id="filterGroup" onchange="filterCourses()">
                <option value="">Lọc theo Nhóm Kiến Thức</option>
            </select>
            <select id="filterSpecialization" onchange="filterCourses()">
                <option value="">Lọc theo Chuyên ngành</option>
                <option value="Công nghệ phần mềm">Công nghệ phần mềm</option>
                <option value="Hệ thống thông tin">Hệ thống thông tin</option>
                <option value="Mạng máy tính">Mạng máy tính</option>
            </select>
        </div>

        <table id="courseTable">
            <thead>
                <tr>
                    <th>TT</th>
                    <th>Mã HP</th>
                    <th>Tên Học phần</th>
                    <th>Mã CTĐT</th>
                    <th>Số tín chỉ</th>
                    <th>Lý thuyết</th>
                    <th>Thực hành</th>
                    <th>Thực tập</th>
                    <th>Hệ số</th>
                    <th th:if="${isAdmin}">Thao Tác</th>
                </tr>
            </thead>
            <tbody id="courseTableBody"></tbody>
        </table>
    </div>

    <!-- Modal for Viewing Details -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Chi Tiết Học Phần</h2>
                <span class="close" onclick="closeModal('viewModal')">×</span>
            </div>
            <div class="modal-body">
                <div class="info-row">
                    <label>Mã Học Phần:</label>
                    <span id="viewCourseId"></span>
                </div>
                <div class="info-row">
                    <label>Tên Học Phần:</label>
                    <span id="viewCourseName"></span>
                </div>
                <div class="info-row">
                    <label>Mã CTĐT:</label>
                    <span id="viewTrainingProgram"></span>
                </div>
                <div class="info-row">
                    <label>Khối Kiến Thức:</label>
                    <span id="viewBlock"></span>
                </div>
                <div class="info-row">
                    <label>Nhóm Kiến Thức:</label>
                    <span id="viewGroup"></span>
                </div>
                <div class="info-row">
                    <label>Chuyên ngành:</label>
                    <span id="viewSpecialization"></span>
                </div>
                <div class="info-row">
                    <label>Số Tín Chỉ Lý Thuyết:</label>
                    <span id="viewTheoryCredits"></span>
                </div>
                <div class="info-row">
                    <label>Số Tín Chỉ Thực Hành:</label>
                    <span id="viewPracticeCredits"></span>
                </div>
                <div class="info-row">
                    <label>Số Tín Chỉ Thực Tập:</label>
                    <span id="viewInternshipCredits"></span>
                </div>
                <div class="info-row">
                    <label>Tổng Số Tín Chỉ:</label>
                    <span id="viewTotalCredits"></span>
                </div>
                <div class="info-row">
                    <label>Số Tiết:</label>
                    <span id="viewHours"></span>
                </div>
                <div class="info-row">
                    <label>Hệ Số:</label>
                    <span id="viewCoefficient"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Adding New Course -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Thêm Học Phần Mới</h2>
                <span class="close" onclick="closeModal('addModal')">×</span>
            </div>
            <div class="modal-body">
                <form id="addForm">
                    <div class="form-row">
                        <label for="newCourseId">Mã Học Phần:</label>
                        <span id="newCourseId" class="static-field"></span>
                    </div>
                    <div class="form-row">
                        <label for="trainingProgram">Mã CTĐT:</label>
                        <input type="text" id="trainingProgram" required>
                    </div>
                    <div class="form-row">
                        <label for="courseName">Tên Học Phần:</label>
                        <input type="text" id="courseName" required>
                    </div>
                    <div class="form-row">
                        <label for="blockSelect">Khối Kiến Thức:</label>
                        <select id="blockSelect" onchange="updateGroupSelect('add')" required>
                            <option value="">-- Chọn Khối Kiến Thức --</option>
                            <option value="Khối kiến thức giáo dục đại cương">Khối kiến thức giáo dục đại cương</option>
                            <option value="Khối kiến thức giáo dục chuyên nghiệp">Khối kiến thức giáo dục chuyên nghiệp
                            </option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="groupSelect">Nhóm Kiến Thức:</label>
                        <select id="groupSelect" onchange="toggleSpecializationSelect('add')" disabled></select>
                    </div>
                    <div class="form-row" id="addSpecializationRow" style="display: none;">
                        <label for="specializationSelect">Chuyên ngành:</label>
                        <select id="specializationSelect">
                            <option value="">-- Chọn Chuyên ngành --</option>
                            <option value="Công nghệ phần mềm">Công nghệ phần mềm</option>
                            <option value="Hệ thống thông tin">Hệ thống thông tin</option>
                            <option value="Mạng máy tính">Mạng máy tính</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="theoryCredits">Số Tín Chỉ Lý Thuyết:</label>
                        <input type="number" id="theoryCredits" min="0" required>
                    </div>
                    <div class="form-row">
                        <label for="practiceCredits">Số Tín Chỉ Thực Hành:</label>
                        <input type="number" id="practiceCredits" min="0" required>
                    </div>
                    <div class="form-row">
                        <label for="internshipCredits">Số Tín Chỉ Thực Tập:</label>
                        <input type="number" id="internshipCredits" min="0" required>
                    </div>
                    <div class="form-row">
                        <label for="hours">Số Tiết:</label>
                        <input type="number" id="hours" min="1" required>
                    </div>
                    <div class="form-row">
                        <label for="coefficient">Hệ Số:</label>
                        <input type="number" id="coefficient" min="1" step="0.1" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="save-btn" onclick="saveNewCourse()">Thêm</button>
                        <button type="button" class="cancel-btn" onclick="closeModal('addModal')">Hủy</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for Editing Course -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sửa Học Phần</h2>
                <span class="close" onclick="closeModal('editModal')">×</span>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <div class="form-row">
                        <label for="editCourseId">Mã Học Phần:</label>
                        <span id="editCourseId" class="static-field"></span>
                    </div>
                    <div class="form-row">
                        <label for="editTrainingProgram">Mã CTĐT:</label>
                        <input type="text" id="editTrainingProgram" required>
                    </div>
                    <div class="form-row">
                        <label for="editCourseName">Tên Học Phần:</label>
                        <input type="text" id="editCourseName" required>
                    </div>
                    <div class="form-row">
                        <label for="editBlockSelect">Khối Kiến Thức:</label>
                        <select id="editBlockSelect" onchange="updateGroupSelect('edit')" required>
                            <option value="">-- Chọn Khối Kiến Thức --</option>
                            <option value="Khối kiến thức giáo dục đại cương">Khối kiến thức giáo dục đại cương</option>
                            <option value="Khối kiến thức giáo dục chuyên nghiệp">Khối kiến thức giáo dục chuyên nghiệp
                            </option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="editGroupSelect">Nhóm Kiến Thức:</label>
                        <select id="editGroupSelect" onchange="toggleSpecializationSelect('edit')" disabled></select>
                    </div>
                    <div class="form-row" id="editSpecializationRow" style="display: none;">
                        <label for="editSpecializationSelect">Chuyên ngành:</label>
                        <select id="editSpecializationSelect">
                            <option value="">-- Chọn Chuyên ngành --</option>
                            <option value="Công nghệ phần mềm">Công nghệ phần mềm</option>
                            <option value="Hệ thống thông tin">Hệ thống thông tin</option>
                            <option value="Mạng máy tính">Mạng máy tính</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="editTheoryCredits">Số Tín Chỉ Lý Thuyết:</label>
                        <input type="number" id="editTheoryCredits" min="0" required>
                    </div>
                    <div class="form-row">
                        <label for="editPracticeCredits">Số Tín Chỉ Thực Hành:</label>
                        <input type="number" id="editPracticeCredits" min="0" required>
                    </div>
                    <div class="form-row">
                        <label for="editInternshipCredits">Số Tín Chỉ Thực Tập:</label>
                        <input type="number" id="editInternshipCredits" min="0" required>
                    </div>
                    <div class="form-row">
                        <label for="editHours">Số Tiết:</label>
                        <input type="number" id="editHours" min="1" required>
                    </div>
                    <div class="form-row">
                        <label for="editCoefficient">Hệ Số:</label>
                        <input type="number" id="editCoefficient" min="1" step="0.1" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="save-btn" onclick="saveEdit()">Lưu</button>
                        <button type="button" class="cancel-btn" onclick="closeModal('editModal')">Hủy</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for Delete Confirmation -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Xác Nhận Xóa</h2>
                <span class="close" onclick="closeModal('deleteModal')">×</span>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa học phần <span id="deleteCourseName"></span> không? Thông tin sẽ bị xóa
                    vĩnh viễn.</p>
                <div class="form-actions">
                    <button class="delete-btn" onclick="confirmDelete()">Xóa</button>
                    <button class="cancel-btn" onclick="closeModal('deleteModal')">Hủy</button>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // Lấy thông tin quyền từ server
        const isAdmin = /*[[${isAdmin}]]*/ false;
        const isTeacher = /*[[${isTeacher}]]*/ false;
        const isUser = /*[[${isUser}]]*/ false;
        const userRole = /*[[${userRole}]]*/ '';
        
        // Ẩn/hiện các nút chức năng dựa vào quyền
        function checkPermission() {
            const adminButtons = document.querySelectorAll('.add-btn, .edit-btn, .delete-btn');
            adminButtons.forEach(button => {
                button.style.display = isAdmin ? 'inline-block' : 'none';
            });

            // Ẩn các modal không cần thiết nếu không phải admin
            if (!isAdmin) {
                const addModal = document.getElementById('addModal');
                const editModal = document.getElementById('editModal');
                const deleteModal = document.getElementById('deleteModal');
                if (addModal) addModal.style.display = 'none';
                if (editModal) editModal.style.display = 'none';
                if (deleteModal) deleteModal.style.display = 'none';
            }
        }

        // Gọi hàm kiểm tra quyền khi trang load
        window.onload = function() {
            checkPermission();
            loadCourses();
            filterCourses();
        }
    </script>

    <script>
        // Mock data for CNTT courses
        let courses = [
            { id: "8613101", name: "Triết học Mác – Lênin", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Lý luận chính trị", specialization: "", theoryCredits: 3, practiceCredits: 0, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "8613102", name: "Kinh tế chính trị Mác – Lênin", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Lý luận chính trị", specialization: "", theoryCredits: 2, practiceCredits: 0, internshipCredits: 0, hours: 30, coefficient: 1 },
            { id: "8613103", name: "Chủ nghĩa xã hội khoa học", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Lý luận chính trị", specialization: "", theoryCredits: 2, practiceCredits: 0, internshipCredits: 0, hours: 30, coefficient: 1 },
            { id: "8613104", name: "Tư tưởng Hồ Chí Minh", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Lý luận chính trị", specialization: "", theoryCredits: 2, practiceCredits: 0, internshipCredits: 0, hours: 30, coefficient: 1 },
            { id: "8613105", name: "Lịch sử Đảng Cộng sản Việt Nam", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Lý luận chính trị", specialization: "", theoryCredits: 2, practiceCredits: 0, internshipCredits: 0, hours: 30, coefficient: 1 },
            { id: "8664001", name: "Tiếng Anh 1", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Ngôn ngữ", specialization: "", theoryCredits: 3, practiceCredits: 0, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "8664002", name: "Tiếng Anh 2", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Ngôn ngữ", specialization: "", theoryCredits: 3, practiceCredits: 0, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "8664003", name: "Tiếng Anh 3", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Ngôn ngữ", specialization: "", theoryCredits: 3, practiceCredits: 0, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "8655006", name: "Pháp luật đại cương", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức giáo dục đại cương khác", specialization: "", theoryCredits: 2, practiceCredits: 0, internshipCredits: 0, hours: 30, coefficient: 1 },
            { id: "8645008", name: "Xác suất thống kê", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức giáo dục đại cương khác", specialization: "", theoryCredits: 3, practiceCredits: 0, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "8644005", name: "Giải tích 1", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức giáo dục đại cương khác", specialization: "", theoryCredits: 3, practiceCredits: 0, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "8644006", name: "Giải tích 2", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức giáo dục đại cương khác", specialization: "", theoryCredits: 3, practiceCredits: 0, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "8644007", name: "Đại số tuyến tính", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức giáo dục đại cương khác", specialization: "", theoryCredits: 3, practiceCredits: 0, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "8622101", name: "Giáo dục thể chất (I)", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Giáo dục thể chất và Giáo dục quốc phòng và an ninh", specialization: "", theoryCredits: 0, practiceCredits: 1, internshipCredits: 0, hours: 30, coefficient: 1 },
            { id: "8622406", name: "Giáo dục quốc phòng và an ninh I", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Giáo dục thể chất và Giáo dục quốc phòng và an ninh", specialization: "", theoryCredits: 2, practiceCredits: 1, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "8622407", name: "Giáo dục quốc phòng và an ninh II", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Giáo dục thể chất và Giáo dục quốc phòng và an ninh", specialization: "", theoryCredits: 1, practiceCredits: 1, internshipCredits: 0, hours: 30, coefficient: 1 },
            { id: "8622408", name: "Giáo dục quốc phòng và an ninh III", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Giáo dục thể chất và Giáo dục quốc phòng và an ninh", specialization: "", theoryCredits: 1, practiceCredits: 1, internshipCredits: 0, hours: 30, coefficient: 1 },
            { id: "8622409", name: "Giáo dục quốc phòng và an ninh IV", trainingProgram: "CTDT01", block: "Khối kiến thức giáo dục đại cương", group: "Kiến thức Giáo dục thể chất và Giáo dục quốc phòng và an ninh", specialization: "", theoryCredits: 1, practiceCredits: 3, internshipCredits: 0, hours: 60, coefficient: 1 },
            { id: "CNTT1001", name: "Lập trình cơ bản", trainingProgram: "CTDT02", block: "Khối kiến thức giáo dục chuyên nghiệp", group: "Kiến thức cơ sở của ngành", specialization: "", theoryCredits: 2, practiceCredits: 1, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "CNTT1002", name: "Cấu trúc dữ liệu và giải thuật", trainingProgram: "CTDT02", block: "Khối kiến thức giáo dục chuyên nghiệp", group: "Kiến thức cơ sở của ngành", specialization: "", theoryCredits: 2, practiceCredits: 1, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "CNTT1003", name: "Kiến trúc máy tính", trainingProgram: "CTDT02", block: "Khối kiến thức giáo dục chuyên nghiệp", group: "Kiến thức cơ sở của ngành", specialization: "", theoryCredits: 2, practiceCredits: 1, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "CNTT2001", name: "Lập trình hướng đối tượng", trainingProgram: "CTDT02", block: "Khối kiến thức giáo dục chuyên nghiệp", group: "Kiến thức ngành", specialization: "", theoryCredits: 2, practiceCredits: 1, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "CNTT2002", name: "Cơ sở dữ liệu", trainingProgram: "CTDT02", block: "Khối kiến thức giáo dục chuyên nghiệp", group: "Kiến thức ngành", specialization: "", theoryCredits: 2, practiceCredits: 1, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "CNTT2003", name: "Mạng máy tính", trainingProgram: "CTDT02", block: "Khối kiến thức giáo dục chuyên nghiệp", group: "Kiến thức ngành", specialization: "", theoryCredits: 2, practiceCredits: 1, internshipCredits: 0, hours: 45, coefficient: 1 },
            { id: "CNTT3001", name: "Phát triển phần mềm", trainingProgram: "CTDT03", block: "Khối kiến thức giáo dục chuyên nghiệp", group: "Kiến thức chuyên ngành (nếu có)", specialization: "Công nghệ phần mềm", theoryCredits: 2, practiceCredits: 2, internshipCredits: 0, hours: 60, coefficient: 1 },
            { id: "CNTT3002", name: "Quản trị hệ thống thông tin", trainingProgram: "CTDT03", block: "Khối kiến thức giáo dục chuyên nghiệp", group: "Kiến thức chuyên ngành (nếu có)", specialization: "Hệ thống thông tin", theoryCredits: 2, practiceCredits: 2, internshipCredits: 0, hours: 60, coefficient: 1 },
            { id: "CNTT3003", name: "Quản trị mạng", trainingProgram: "CTDT03", block: "Khối kiến thức giáo dục chuyên nghiệp", group: "Kiến thức chuyên ngành (nếu có)", specialization: "Mạng máy tính", theoryCredits: 2, practiceCredits: 2, internshipCredits: 0, hours: 60, coefficient: 1 }
        ];

        // Knowledge groups mapping
        const knowledgeGroups = {
            "Khối kiến thức giáo dục đại cương": [
                "Các học phần bắt buộc",
                "Kiến thức Giáo dục thể chất và Giáo dục quốc phòng và an ninh",
                "Kiến thức Ngôn ngữ",
                "Kiến thức Lý luận chính trị",
                "Kiến thức giáo dục đại cương khác"
            ],
            "Khối kiến thức giáo dục chuyên nghiệp": [
                "Kiến thức cơ sở của ngành",
                "Kiến thức ngành",
                "Kiến thức chuyên ngành (nếu có)"
            ]
        };

        // Load courses into the table
        function loadCourses(filteredCourses = courses) {
            const tableBody = document.getElementById("courseTableBody");
            tableBody.innerHTML = "";
            filteredCourses.forEach((course, index) => {
                const totalCredits = course.theoryCredits + course.practiceCredits + course.internshipCredits;
                const row = document.createElement("tr");
                row.innerHTML = `
                <td>${index + 1}</td>
                <td>${course.id}</td>
                <td>${course.name}</td>
                <td>${course.trainingProgram}</td>
                <td>${totalCredits}</td>
                <td>${course.theoryCredits}</td>
                <td>${course.practiceCredits}</td>
                <td>${course.internshipCredits}</td>
                <td>${course.coefficient}</td>
                ${isAdmin ? `
                    <td>
                        <button class="edit-btn" onclick="editCourse(${index})">Sửa</button>
                        <button class="delete-btn" onclick="openDeleteModal(${index})">Xóa</button>
                    </td>
                ` : ''}
            `;
                row.onclick = (e) => {
                    if (e.target.tagName !== "BUTTON") viewDetails(index);
                };
                tableBody.appendChild(row);
            });
        }

        // View course details
        function viewDetails(index) {
            const course = courses[index];
            document.getElementById("viewCourseId").textContent = course.id;
            document.getElementById("viewCourseName").textContent = course.name;
            document.getElementById("viewTrainingProgram").textContent = course.trainingProgram;
            document.getElementById("viewBlock").textContent = course.block;
            document.getElementById("viewGroup").textContent = course.group;
            document.getElementById("viewSpecialization").textContent = course.specialization || "Không áp dụng";
            document.getElementById("viewTheoryCredits").textContent = course.theoryCredits;
            document.getElementById("viewPracticeCredits").textContent = course.practiceCredits;
            document.getElementById("viewInternshipCredits").textContent = course.internshipCredits;
            document.getElementById("viewTotalCredits").textContent = course.theoryCredits + course.practiceCredits + course.internshipCredits;
            document.getElementById("viewHours").textContent = course.hours;
            document.getElementById("viewCoefficient").textContent = course.coefficient;
            document.getElementById("viewModal").style.display = "block";
        }

        // Open add modal
        function openAddModal() {
            document.getElementById("newCourseId").textContent = generateCourseId();
            document.getElementById("addForm").reset();
            document.getElementById("groupSelect").disabled = true;
            document.getElementById("groupSelect").innerHTML = '<option value="">-- Chọn Nhóm Kiến Thức --</option>';
            document.getElementById("addSpecializationRow").style.display = "none";
            document.getElementById("addModal").style.display = "block";
        }

        // Generate unique course ID
        function generateCourseId() {
            let id;
            do {
                id = "CNTT" + Math.floor(1000 + Math.random() * 9000).toString();
            } while (courses.some(course => course.id === id));
            return id;
        }

        // Update knowledge group select based on knowledge block
        function updateGroupSelect(modalType) {
            const blockSelect = document.getElementById(modalType === "add" ? "blockSelect" : "editBlockSelect");
            const groupSelect = document.getElementById(modalType === "add" ? "groupSelect" : "editGroupSelect");
            groupSelect.innerHTML = '<option value="">-- Chọn Nhóm Kiến Thức --</option>';
            groupSelect.disabled = !blockSelect.value;

            if (blockSelect.value) {
                const groups = knowledgeGroups[blockSelect.value];
                groups.forEach(group => {
                    const option = document.createElement("option");
                    option.value = group;
                    option.textContent = group;
                    groupSelect.appendChild(option);
                });
            }
            toggleSpecializationSelect(modalType);
        }

        // Toggle specialization select based on group
        function toggleSpecializationSelect(modalType) {
            const groupSelect = document.getElementById(modalType === "add" ? "groupSelect" : "editGroupSelect");
            const specializationRow = document.getElementById(modalType === "add" ? "addSpecializationRow" : "editSpecializationRow");
            if (groupSelect.value === "Kiến thức chuyên ngành (nếu có)") {
                specializationRow.style.display = "flex";
            } else {
                specializationRow.style.display = "none";
                document.getElementById(modalType === "add" ? "specializationSelect" : "editSpecializationSelect").value = "";
            }
        }

        // Save new course
        function saveNewCourse() {
            const theoryCredits = parseInt(document.getElementById("theoryCredits").value) || 0;
            const practiceCredits = parseInt(document.getElementById("practiceCredits").value) || 0;
            const internshipCredits = parseInt(document.getElementById("internshipCredits").value) || 0;
            const trainingProgram = document.getElementById("trainingProgram").value.trim();

            const course = {
                id: document.getElementById("newCourseId").textContent,
                trainingProgram: trainingProgram,
                name: document.getElementById("courseName").value.trim(),
                block: document.getElementById("blockSelect").value,
                group: document.getElementById("groupSelect").value,
                specialization: document.getElementById("groupSelect").value === "Kiến thức chuyên ngành (nếu có)" ? document.getElementById("specializationSelect").value : "",
                theoryCredits: theoryCredits,
                practiceCredits: practiceCredits,
                internshipCredits: internshipCredits,
                hours: parseInt(document.getElementById("hours").value),
                coefficient: parseFloat(document.getElementById("coefficient").value)
            };

            if (!trainingProgram || !course.name || !course.block || !course.group ||
                (course.group === "Kiến thức chuyên ngành (nếu có)" && !course.specialization) ||
                (theoryCredits + practiceCredits + internshipCredits === 0)) {
                alert("Vui lòng điền đầy đủ thông tin, bao gồm mã CTĐT, tên học phần, khối kiến thức, nhóm kiến thức, chuyên ngành (nếu cần) và ít nhất một tín chỉ phải lớn hơn 0!");
                return;
            }

            courses.push(course);
            closeModal("addModal");
            loadCourses();
            filterCourses();
        }

        // Edit course
        let currentEditIndex = null;
        function editCourse(index) {
            currentEditIndex = index;
            const course = courses[index];
            document.getElementById("editCourseId").textContent = course.id;
            document.getElementById("editTrainingProgram").value = course.trainingProgram;
            document.getElementById("editCourseName").value = course.name;
            document.getElementById("editBlockSelect").value = course.block;
            updateGroupSelect("edit");
            document.getElementById("editGroupSelect").value = course.group;
            toggleSpecializationSelect("edit");
            document.getElementById("editSpecializationSelect").value = course.specialization;
            document.getElementById("editTheoryCredits").value = course.theoryCredits;
            document.getElementById("editPracticeCredits").value = course.practiceCredits;
            document.getElementById("editInternshipCredits").value = course.internshipCredits;
            document.getElementById("editHours").value = course.hours;
            document.getElementById("editCoefficient").value = course.coefficient;
            document.getElementById("editModal").style.display = "block";
        }

        function saveEdit() {
            const course = courses[currentEditIndex];
            const theoryCredits = parseInt(document.getElementById("editTheoryCredits").value) || 0;
            const practiceCredits = parseInt(document.getElementById("editPracticeCredits").value) || 0;
            const internshipCredits = parseInt(document.getElementById("editInternshipCredits").value) || 0;
            const trainingProgram = document.getElementById("editTrainingProgram").value.trim();

            course.trainingProgram = trainingProgram;
            course.name = document.getElementById("editCourseName").value.trim();
            course.block = document.getElementById("editBlockSelect").value;
            course.group = document.getElementById("editGroupSelect").value;
            course.specialization = course.group === "Kiến thức chuyên ngành (nếu có)" ? document.getElementById("editSpecializationSelect").value : "";
            course.theoryCredits = theoryCredits;
            course.practiceCredits = practiceCredits;
            course.internshipCredits = internshipCredits;
            course.hours = parseInt(document.getElementById("editHours").value);
            course.coefficient = parseFloat(document.getElementById("editCoefficient").value);

            if (!trainingProgram || !course.name || !course.block || !course.group ||
                (course.group === "Kiến thức chuyên ngành (nếu có)" && !course.specialization) ||
                (theoryCredits + practiceCredits + internshipCredits === 0)) {
                alert("Vui lòng điền đầy đủ thông tin, bao gồm mã CTĐT, tên học phần, khối kiến thức, nhóm kiến thức, chuyên ngành (nếu cần) và ít nhất một tín chỉ phải lớn hơn 0!");
                return;
            }

            closeModal("editModal");
            loadCourses();
            filterCourses();
        }

        // Delete course
        let currentDeleteIndex = null;
        function openDeleteModal(index) {
            currentDeleteIndex = index;
            document.getElementById("deleteCourseName").textContent = courses[index].name;
            document.getElementById("deleteModal").style.display = "block";
        }

        function confirmDelete() {
            courses.splice(currentDeleteIndex, 1);
            closeModal("deleteModal");
            loadCourses();
            filterCourses();
        }

        // Search courses
        function searchCourses() {
            const query = document.getElementById("searchInput").value.toLowerCase();
            const filteredCourses = courses.filter(course =>
                course.id === query || course.name.toLowerCase().includes(query)
            );
            loadCourses(filteredCourses);
        }

        // Filter courses
        function filterCourses() {
            const blockFilter = document.getElementById("filterBlock").value;
            const groupFilter = document.getElementById("filterGroup").value;
            const specializationFilter = document.getElementById("filterSpecialization").value;

            // Update group filter options based on block filter
            const groupSelect = document.getElementById("filterGroup");
            groupSelect.innerHTML = '<option value="">Lọc theo Nhóm Kiến Thức</option>';
            if (blockFilter) {
                const groups = knowledgeGroups[blockFilter];
                groups.forEach(group => {
                    const option = document.createElement("option");
                    option.value = group;
                    option.textContent = group;
                    groupSelect.appendChild(option);
                });
            }

            let filteredCourses = courses;
            if (blockFilter) {
                filteredCourses = filteredCourses.filter(course => course.block === blockFilter);
            }
            if (groupFilter) {
                filteredCourses = filteredCourses.filter(course => course.group === groupFilter);
            }
            if (specializationFilter) {
                filteredCourses = filteredCourses.filter(course => course.specialization === specializationFilter);
            }

            loadCourses(filteredCourses);
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }
    </script>
</body>

</html>